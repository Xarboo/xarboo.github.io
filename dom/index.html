<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>DOM — przykłady (Vibrant + Lightbox)</title>
    <style>
        :root{
            --bg: linear-gradient(180deg,#040712 0%, #07102b 60%);
            --card: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
            --accent: #00f0ff;
            --accent-2: #a855f7;
            --muted: #9fb4c9;
            --btn-bg: linear-gradient(135deg,var(--accent),var(--accent-2));
            --glass: rgba(255,255,255,0.04);
            --neon: 0 6px 24px rgba(124,58,237,0.22), 0 0 30px rgba(6,182,212,0.06);
        }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        *{ box-sizing: border-box; }
        body{
            font-family: Inter, Roboto, system-ui, Arial, sans-serif;
            background: var(--bg);
            color: #eaf6ff;
            margin: 0;
            padding: 32px;
            -webkit-font-smoothing:antialiased;
            -moz-osx-font-smoothing:grayscale;
        }
        .wrap{
            max-width: 1100px;
            margin: 0 auto;
        }
        h1{
            margin: 0 0 8px;
            font-size: 26px;
            color: #fff;
            letter-spacing: -0.02em;
        }
        p.lead{ color: var(--muted); margin-top:4px; margin-bottom:20px; font-size:15px; }

        .grid{
            display: grid;
            grid-template-columns: repeat(auto-fit,minmax(300px,1fr));
            gap: 18px;
        }
        .card{
            background: var(--card);
            border: 1px solid rgba(255,255,255,0.04);
            padding: 16px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(2,6,23,0.6);
            transition: transform .16s ease, box-shadow .16s ease;
        }
        .card:hover{ transform: translateY(-6px); box-shadow: var(--neon); }
        .card h2{ margin: 0 0 10px; font-size: 18px; color: #fff; }
        .controls{ display:flex; gap:10px; flex-wrap:wrap; margin-bottom:12px; }

        .btn{
            appearance: none;
            border: none;
            color: white;
            padding: 8px 14px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 700;
            background: var(--btn-bg);
            box-shadow: var(--neon);
            transition: transform .12s ease, filter .12s ease, box-shadow .12s ease;
        }
        .btn:active{ transform: translateY(1px) scale(.995); }
        .btn.ghost{
            background: transparent;
            border: 1px solid rgba(255,255,255,0.06);
            color: var(--muted);
            box-shadow: none;
        }
        .example-area{
            padding: 14px;
            background: linear-gradient(180deg, rgba(255,255,255,0.02), transparent);
            border-radius: 10px;
            min-height: 74px;
            border: 1px solid rgba(255,255,255,0.02);
        }
        .element{
            display:inline-block;
            padding:10px 12px;
            border-radius:8px;
            margin:6px;
            font-weight:800;
            box-shadow: 0 8px 20px rgba(2,6,23,0.55);
            color: #05141a;
        }
        .test-cnt strong{ display:inline-block; margin:6px; padding:6px 10px; background:rgba(255,255,255,0.03); border-radius:8px; color:var(--muted); }

        .card .note{ font-size:13px; color:var(--muted); margin-top:10px; }
        .template-card{
            padding:12px;
            border-radius:10px;
            background: linear-gradient(180deg,#021427,#071a2a);
            border:1px solid rgba(255,255,255,0.03);
        }
        .card .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
        .muted{ color:var(--muted); font-size:14px; }

        /* Slider styles */
        .slider-wrap{ display:flex; flex-direction:column; gap:10px; }
        .slider{ position:relative; overflow:hidden; border-radius:12px; background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border:1px solid rgba(255,255,255,0.02); }
        .slides{ display:flex; transition: transform 420ms cubic-bezier(.2,.9,.2,1); will-change: transform; }
        .slide{ min-width:100%; padding:28px; box-sizing:border-box; display:flex; align-items:center; justify-content:center; flex-direction:column; gap:10px; height:200px; color:#072b34; font-weight:700; border-radius:10px; }
        .slide .caption{ color:#073042; font-weight:800; font-size:18px; text-shadow: 0 2px 8px rgba(255,255,255,0.06); }
        .slider-controls{ position:absolute; top:50%; left:0; right:0; display:flex; justify-content:space-between; transform:translateY(-50%); padding:0 8px; pointer-events:none; }
        .slider-controls button{ pointer-events:auto; background:rgba(0,0,0,0.32); border:none; color:#fff; padding:8px 10px; border-radius:8px; }
        .dots{ display:flex; gap:6px; justify-content:center; padding:8px 0; }
        .dot{ width:12px; height:12px; border-radius:50%; background:rgba(255,255,255,0.12); cursor:pointer; border:1px solid rgba(255,255,255,0.03); }
        .dot.active{ background:var(--accent); box-shadow:0 5px 14px rgba(6,182,212,0.18); }

        /* Lightbox */
        .gallery{ display:flex; gap:12px; flex-wrap:wrap; align-items:center; }
        .thumb{
            width:160px; height:100px; border-radius:8px; overflow:hidden; cursor:pointer;
            flex: 0 0 auto; position:relative; border:2px solid rgba(255,255,255,0.03);
            box-shadow: 0 8px 18px rgba(2,6,23,0.45);
            transition: transform .14s ease, box-shadow .14s ease;
        }
        .thumb img{ width:100%; height:100%; object-fit:cover; display:block; }
        .thumb:hover{ transform: translateY(-6px) scale(1.02); box-shadow: var(--neon); }
        .thumb .caption{ position:absolute; left:8px; bottom:8px; color:#fff; font-weight:700; text-shadow:0 2px 12px rgba(0,0,0,0.6); font-size:13px; }

        .lightbox{
            position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:9999;
            background: linear-gradient(to bottom right, rgba(2,6,23,0.85), rgba(3,8,37,0.95));
            padding:28px;
        }
        .lightbox.open{ display:flex; }
        .lb-content{ max-width:1100px; width:100%; max-height:88vh; display:flex; gap:20px; align-items:center; justify-content:center; }
        .lb-img-wrap{ flex:1 1 auto; display:flex; align-items:center; justify-content:center; }
        .lb-img{ max-width:100%; max-height:80vh; border-radius:10px; box-shadow: 0 18px 60px rgba(6,26,40,0.75); }
        .lb-sidebar{ width:320px; max-width:34%; display:flex; flex-direction:column; gap:12px; color:var(--muted); }
        .lb-title{ color:#fff; font-weight:800; font-size:20px; margin-bottom:6px; }
        .lb-controls{ display:flex; gap:8px; margin-top:auto; }
        .lb-btn{ background:rgba(255,255,255,0.06); border:1px solid rgba(255,255,255,0.03); color:var(--muted); padding:8px 12px; border-radius:8px; cursor:pointer; }
        .lb-close{ position:absolute; top:18px; right:18px; background:transparent; border:1px solid rgba(255,255,255,0.06); color:#fff; padding:8px 10px; border-radius:10px; cursor:pointer; }

        @media (max-width:900px){
            .lb-sidebar{ display:none; }
            .lb-img{ max-height:68vh; }
            .thumb{ width:48%; height:110px; }
        }
    </style>
</head>
<body>
    <div class="wrap">
        <h1>Przykłady manipulacji DOM — Vibrant</h1>
        <p class="lead">Zaktualizowano wygląd na bardziej żywy, dodano lekki neonowy akcent. Na końcu znajduje się prosty, dostępny lightbox — kliknij miniaturę, aby zobaczyć pełne zdjęcie.</p>

        <div class="grid">

            <!-- 1. Tworzenie i wstawianie elementów -->
            <section class="card" id="section-create">
                <h2>1. Tworzenie & wstawianie elementów</h2>
                <div class="controls">
                    <button class="btn" id="btn-append">Dodaj (appendChild)</button>
                    <button class="btn" id="btn-insertBefore">Wstaw przed 2. &lt;strong&gt;</button>
                    <button class="btn ghost" id="btn-prepend">Prepend</button>
                    <button class="btn ghost" id="btn-after">After</button>
                </div>

                <div class="example-area">
                    <div class="test-cnt" style="padding:8px;">
                        <strong>strong</strong>
                        <strong>strong</strong>
                    </div>
                </div>
                <div class="note">Elementy otrzymują losowy, energetyczny kolor (HSL). Przykład pokazuje klasyczne metody oraz nowe (append/prepend/after).</div>
            </section>

            <!-- 2. Węzły tekstowe (createTextNode) -->
            <section class="card" id="section-textnode">
                <h2>2. Węzły tekstowe (createTextNode)</h2>
                <div class="controls">
                    <button class="btn" id="btn-changeWords">Zmień słowa</button>
                    <button class="btn ghost" id="btn-resetWords">Reset</button>
                </div>

                <div class="example-area">
                    <p id="testNodeText" style="font-size:16px;"> <!-- zostanie wypełnione przez skrypt --> </p>
                </div>
                <div class="note">Słowa utworzone są jako węzły tekstowe — łatwo je potem zamieniać bez dodawania dodatkowych elementów.</div>
            </section>

            <!-- 3. Template i klonowanie -->
            <section class="card" id="section-template">
                <h2>3. Template & klonowanie</h2>
                <div class="controls">
                    <button class="btn" id="btn-clone-noevents">Klonuj (bez eventów)</button>
                    <button class="btn" id="btn-clone-withevents">Klonuj (podczep eventy)</button>
                    <button class="btn ghost" id="btn-clearClones">Usuń wszystkie</button>
                </div>

                <div class="example-area">
                    <div class="target"></div>
                </div>

                <div class="note">Klonując elementy zdarzenia nie są kopiowane. Przyciski "Klonuj (podczep eventy)" rejestrują akcję ręcznie.</div>

                <template id="cardTemplate">
                    <div class="template-card">
                        <h3 class="card-title">Karta — <span class="num"></span></h3>
                        <p class="card-text">Przykładowy opis. Ta karta ma przycisk z akcją.</p>
                        <div class="row">
                            <button class="btn btn-card-action" type="button">Akcja</button>
                            <button class="btn ghost btn-remove">Usuń</button>
                        </div>
                    </div>
                </template>
            </section>

            <!-- 4. Slider -->
            <section class="card" id="section-slider">
                <h2>4. Prosty slider (JS)</h2>
                <div class="controls">
                    <button class="btn" id="prevSlide">‹ Poprzedni</button>
                    <button class="btn" id="nextSlide">Następny ›</button>
                    <button class="btn ghost" id="toggleAutoplay">Pauza</button>
                </div>

                <div class="example-area slider-wrap">
                    <div class="slider" id="slider" aria-roledescription="carousel">
                        <div class="slides">
                            <div class="slide" style="background:linear-gradient(135deg,#ff9a9e,#fecfef);">
                                <div class="label">Slajd 1</div>
                                <div class="caption">Witaj w sliderze</div>
                            </div>
                            <div class="slide" style="background:linear-gradient(135deg,#a8ff78,#78ffd6);">
                                <div class="label">Slajd 2</div>
                                <div class="caption">Można przewijać ręcznie lub automatycznie</div>
                            </div>
                            <div class="slide" style="background:linear-gradient(135deg,#9be7ff,#7a6fff);">
                                <div class="label">Slajd 3</div>
                                <div class="caption">Obsługa klawiatury i pauzy po najechaniu</div>
                            </div>
                        </div>
                        <div class="slider-controls" aria-hidden="true">
                            <button id="btnPrev" aria-label="Poprzedni">◀</button>
                            <button id="btnNext" aria-label="Następny">▶</button>
                        </div>
                    </div>

                    <div style="display:flex;justify-content:space-between;align-items:center;">
                        <div class="dots" id="dots" aria-hidden="true"></div>
                        <div class="playstate" id="playState">autoplay: on</div>
                    </div>
                </div>

                <div class="note">Slider jest prosty, nie wymaga żadnych zewnętrznych bibliotek. Pauzuje na hover i reaguje na strzałki.</div>
            </section>

            <!-- 5. Lightbox -->
            <section class="card" id="section-lightbox">
                <h2>5. Lightbox — galeria</h2>
                <div class="controls">
                    <button class="btn" id="shuffleGallery">Przetasuj miniatury</button>
                    <button class="btn ghost" id="clearGallery">Wyczyść</button>
                </div>

                <div class="example-area">
                    <div class="gallery" id="gallery">
                        <!-- thumbnails inserted by JS -->
                    </div>
                </div>

                <div class="note">Kliknij miniaturę, aby otworzyć zdjęcie w lightboxie. Obsługa klawiatury: Escape (zamknij), ← → (nawigacja).</div>
            </section>

        </div>
    </div>

    <!-- Lightbox markup (inserted once) -->
    <div class="lightbox" id="lightbox" aria-hidden="true" role="dialog" aria-modal="true">
        <button class="lb-close" id="lbClose" aria-label="Zamknij">✕</button>
        <div class="lb-content" role="document">
            <div class="lb-img-wrap">
                <img src="" alt="" class="lb-img" id="lbImage">
            </div>
            <aside class="lb-sidebar">
                <div>
                    <div class="lb-title" id="lbTitle">Tytuł</div>
                    <div class="lb-desc" id="lbDesc">Krótki opis zdjęcia</div>
                </div>
                <div class="lb-controls">
                    <button class="lb-btn" id="lbPrev">◀ Poprzednie</button>
                    <button class="lb-btn" id="lbNext">Następne ▶</button>
                    <button class="lb-btn" id="lbZoom">Powiększ</button>
                </div>
            </aside>
        </div>
    </div>

    <script>
        // ----------------------------
        // 1) Tworzenie i wstawianie
        // ----------------------------
        (function(){
            let counter = 0;
            const appendBtn = document.getElementById('btn-append');
            const insertBeforeBtn = document.getElementById('btn-insertBefore');
            const prependBtn = document.getElementById('btn-prepend');
            const afterBtn = document.getElementById('btn-after');
            const container = document.querySelector('.test-cnt');

            function makeEl(text){
                const el = document.createElement('div');
                el.classList.add('element');
                el.style.background = `hsl(${Math.floor(Math.random()*360)},85%,62%)`;
                el.style.color = '#04121a';
                el.textContent = text;
                return el;
            }

            appendBtn.addEventListener('click', () => {
                const el = makeEl(`Nowy ${++counter}`);
                container.appendChild(el);
            });

            insertBeforeBtn.addEventListener('click', () => {
                const el = makeEl(`Wstawiony ${++counter}`);
                const strongs = container.querySelectorAll('strong');
                const second = strongs[1] ?? null;
                if (second) {
                    container.insertBefore(el, second);
                } else {
                    container.appendChild(el);
                }
            });

            prependBtn.addEventListener('click', () => {
                const el = makeEl(`Na początku ${++counter}`);
                container.prepend(el);
            });

            afterBtn.addEventListener('click', () => {
                const el = makeEl(`Za kontenerem ${++counter}`);
                container.after(el);
            });
        })();

        // ----------------------------
        // 2) createTextNode
        // ----------------------------
        (function(){
            const p = document.getElementById('testNodeText');
            const btn = document.getElementById('btn-changeWords');
            const btnReset = document.getElementById('btn-resetWords');

            const word1 = document.createTextNode("Psy");
            const middle = document.createTextNode(" są ");
            const word2 = document.createTextNode("fajne");

            p.appendChild(word1);
            p.appendChild(middle);
            p.appendChild(word2);

            let toggled = false;
            btn.addEventListener('click', () => {
                if (!toggled) {
                    word1.textContent = "Koty też";
                    word2.textContent = "super!";
                    toggled = true;
                } else {
                    word1.textContent = "Psy";
                    word2.textContent = "fajne";
                    toggled = false;
                }
            });

            btnReset.addEventListener('click', () => {
                word1.textContent = "Psy";
                word2.textContent = "fajne";
                toggled = false;
            });
        })();

        // ----------------------------
        // 3) Template i klonowanie
        // ----------------------------
        (function(){
            const template = document.getElementById('cardTemplate');
            const target = document.querySelector('.target');
            const cloneNoEventsBtn = document.getElementById('btn-clone-noevents');
            const cloneWithEventsBtn = document.getElementById('btn-clone-withevents');
            const clearBtn = document.getElementById('btn-clearClones');
            let cardCount = 0;

            function createClone(){
                if (!('content' in document.createElement('template'))) {
                    const frag = document.createElement('div');
                    frag.innerHTML = template.innerHTML;
                    return frag;
                }
                const clone = template.content.cloneNode(true);
                const num = clone.querySelector('.num');
                if (num) num.textContent = ++cardCount;
                return clone;
            }

            cloneNoEventsBtn.addEventListener('click', () => {
                const clone = createClone();
                target.appendChild(clone);
            });

            cloneWithEventsBtn.addEventListener('click', () => {
                const clone = createClone();
                const wrapper = document.createElement('div');
                wrapper.appendChild(clone);
                const btn = wrapper.querySelector('.btn-card-action');
                const removeBtn = wrapper.querySelector('.btn-remove');

                if (btn) {
                    btn.addEventListener('click', () => {
                        alert('Kliknąłeś przycisk Akcja na karcie #' + wrapper.querySelector('.num').textContent);
                    });
                }
                if (removeBtn) {
                    removeBtn.addEventListener('click', () => {
                        wrapper.remove();
                    });
                }
                target.appendChild(wrapper);
            });

            clearBtn.addEventListener('click', () => {
                target.innerHTML = '';
                cardCount = 0;
            });

            target.addEventListener('click', (e) => {
                if (e.target.matches('.btn-card-action')) {
                    const card = e.target.closest('.template-card');
                    const num = card ? card.querySelector('.num')?.textContent : '(?)';
                    alert('Delegacja: Akcja na karcie #' + (num ?? '(?)'));
                } else if (e.target.matches('.btn-remove')) {
                    const cardWrap = e.target.closest('.template-card') || e.target.closest('div');
                    if (cardWrap) cardWrap.remove();
                }
            });
        })();

        // ----------------------------
        // 4) Slider (prosty)
        // ----------------------------
        (function(){
            const slider = document.getElementById('slider');
            const slidesContainer = slider.querySelector('.slides');
            const slides = Array.from(slidesContainer.children);
            const prevBtn = document.getElementById('prevSlide');
            const nextBtn = document.getElementById('nextSlide');
            const btnPrev = document.getElementById('btnPrev');
            const btnNext = document.getElementById('btnNext');
            const toggleAutoplay = document.getElementById('toggleAutoplay');
            const dotsWrap = document.getElementById('dots');
            const playState = document.getElementById('playState');

            let index = 0;
            let autoplay = true;
            let interval = null;
            const AUTOPLAY_DELAY = 3000;

            function update(){
                slidesContainer.style.transform = `translateX(-${index * 100}%)`;
                dotsWrap.querySelectorAll('.dot').forEach((d,i)=> d.classList.toggle('active', i===index));
            }

            function go(n){
                index = (n + slides.length) % slides.length;
                update();
            }
            function next(){ go(index+1); }
            function prev(){ go(index-1); }

            slides.forEach((s,i)=>{
                const dot = document.createElement('button');
                dot.className = 'dot';
                dot.title = 'Przejdź do slajdu ' + (i+1);
                dot.addEventListener('click', ()=> go(i));
                dotsWrap.appendChild(dot);
            });

            [prevBtn, btnPrev].forEach(b=> b && b.addEventListener('click', prev));
            [nextBtn, btnNext].forEach(b=> b && b.addEventListener('click', next));

            function startAutoplay(){
                stopAutoplay();
                interval = setInterval(next, AUTOPLAY_DELAY);
                autoplay = true;
                toggleAutoplay.textContent = 'Pauza';
                playState.textContent = 'autoplay: on';
            }
            function stopAutoplay(){
                if (interval) clearInterval(interval);
                interval = null;
                autoplay = false;
                toggleAutoplay.textContent = 'Start';
                playState.textContent = 'autoplay: off';
            }

            toggleAutoplay.addEventListener('click', ()=>{
                if (autoplay) stopAutoplay(); else startAutoplay();
            });

            slider.addEventListener('mouseenter', () => { if (autoplay) stopAutoplay(); });
            slider.addEventListener('mouseleave', () => { if (!autoplay) startAutoplay(); });

            window.addEventListener('keydown', (e)=>{
                if (e.key === 'ArrowLeft') prev();
                if (e.key === 'ArrowRight') next();
            });

            (function(){
                let startX = 0, dx = 0;
                slider.addEventListener('touchstart',(e)=> startX = e.touches[0].clientX);
                slider.addEventListener('touchmove',(e)=> { dx = e.touches[0].clientX - startX; });
                slider.addEventListener('touchend', ()=> {
                    if (Math.abs(dx) > 40){ if (dx < 0) next(); else prev(); }
                    startX = dx = 0;
                });
            })();

            go(0);
            startAutoplay();
        })();

        // ----------------------------
        // 5) Lightbox (gallery)
        // ----------------------------
        (function(){
            // Sample images (using picsum.photos for placeholders)
            const images = [
                { src: 'https://fastly.picsum.photos/id/1015/1200/800.jpg?hmac=Fpx-97bpiJi8RKyXmx8pd8pdX2un_8q1Zq4WEGa6z5g', thumb: 'https://picsum.photos/id/1015/600/400', title: 'Góry o świcie', desc: 'Spokojny widok górski o wschodzie słońca.' },
                { src: 'https://picsum.photos/id/1025/1200/800', thumb: 'https://picsum.photos/id/1025/600/400', title: 'Pies w polu', desc: 'Energia i radość na zdjęciu z natury.' },
                { src: 'https://picsum.photos/id/1043/1200/800', thumb: 'https://picsum.photos/id/1043/600/400', title: 'Miejska perspektywa', desc: 'Kolorowe światła i architektura.' }
            ];

            const gallery = document.getElementById('gallery');
            const shuffleBtn = document.getElementById('shuffleGallery');
            const clearBtn = document.getElementById('clearGallery');

            // Lightbox elements
            const lb = document.getElementById('lightbox');
            const lbImage = document.getElementById('lbImage');
            const lbTitle = document.getElementById('lbTitle');
            const lbDesc = document.getElementById('lbDesc');
            const lbClose = document.getElementById('lbClose');
            const lbPrev = document.getElementById('lbPrev');
            const lbNext = document.getElementById('lbNext');
            const lbZoom = document.getElementById('lbZoom');

            let current = 0;
            let zoomed = false;

            function renderGallery(list){
                gallery.innerHTML = '';
                list.forEach((it, idx) => {
                    const t = document.createElement('div');
                    t.className = 'thumb';
                    t.setAttribute('data-index', idx);
                    t.innerHTML = `<img loading="lazy" src="${it.thumb}" alt="${escapeHtml(it.title)}"><div class="caption">${escapeHtml(it.title)}</div>`;
                    t.addEventListener('click', ()=> openLightbox(idx));
                    gallery.appendChild(t);
                });
            }

            function openLightbox(idx){
                current = idx;
                const it = images[current];
                lbImage.src = it.src;
                lbImage.alt = it.title;
                lbTitle.textContent = it.title;
                lbDesc.textContent = it.desc;
                lb.classList.add('open');
                lb.setAttribute('aria-hidden','false');
                document.body.style.overflow = 'hidden';
                // focus management
                lbClose.focus();
            }

            function closeLightbox(){
                lb.classList.remove('open');
                lb.setAttribute('aria-hidden','true');
                document.body.style.overflow = '';
                zoomed = false;
                lbImage.style.transform = '';
            }

            function prev(){
                current = (current - 1 + images.length) % images.length;
                openLightbox(current);
            }
            function next(){
                current = (current + 1) % images.length;
                openLightbox(current);
            }

            function toggleZoom(){
                zoomed = !zoomed;
                lbImage.style.transform = zoomed ? 'scale(1.18)' : '';
            }

            // keyboard & interactions
            document.addEventListener('keydown', (e)=>{
                if (lb.classList.contains('open')) {
                    if (e.key === 'Escape') closeLightbox();
                    if (e.key === 'ArrowLeft') prev();
                    if (e.key === 'ArrowRight') next();
                    if (e.key === '+') toggleZoom();
                }
            });

            lbClose.addEventListener('click', closeLightbox);
            lbPrev.addEventListener('click', prev);
            lbNext.addEventListener('click', next);
            lbZoom.addEventListener('click', toggleZoom);

            // click outside content -> close
            lb.addEventListener('click', (e) => {
                if (e.target === lb) closeLightbox();
            });

            // simple shuffle
            shuffleBtn.addEventListener('click', ()=>{
                for (let i = images.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [images[i], images[j]] = [images[j], images[i]];
                }
                renderGallery(images);
            });

            clearBtn.addEventListener('click', ()=>{
                gallery.innerHTML = '';
            });

            // escape helper for alt text injection
            function escapeHtml(s){ return String(s).replace(/[&<>"']/g, (m)=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m])); }

            // initial render
            renderGallery(images);

            // expose for debugging (optional)
            window.__lightbox = { open: openLightbox, close: closeLightbox, next, prev };
        })();
    </script>
</body>
</html>
